<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>魔物獵人荒野配裝器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            min-height: 100vh;
        }
        .skill-card {
            transition: all 0.3s ease;
        }
        .skill-card:hover {
            transform: translateY(-2px);
        }
        /* 確保在 Tailwind 載入前也有基本樣式 */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: white;
        }
    </style>
</head>
<body class="text-white p-4 md:p-6">
    <div id="app" class="loading">載入中...</div>

    <script>
        // 遊戲資料
        const SKILLS = [
            { id: 'weakness_exploit', name: '弱點特效', maxLevel: 5, description: '攻擊弱點時提升會心率' },
            { id: 'attack_boost', name: '攻擊', maxLevel: 7, description: '提升攻擊力' },
            { id: 'critical_eye', name: '看破', maxLevel: 7, description: '提升會心率' },
            { id: 'agitator', name: '挑戰者', maxLevel: 5, description: '怪物憤怒時提升攻擊和會心' },
            { id: 'divine_blessing', name: '精靈加護', maxLevel: 5, description: '機率減少受到的傷害' },
            { id: 'evade_window', name: '迴避性能', maxLevel: 5, description: '延長迴避無敵時間' },
            { id: 'evade_extender', name: '迴避距離', maxLevel: 3, description: '增加迴避距離' },
            { id: 'speed_eating', name: '快吃', maxLevel: 3, description: '加快道具使用速度' },
            { id: 'constitution', name: '體術', maxLevel: 3, description: '減少持續消耗的耐力' },
            { id: 'speed_sharpening', name: '砥石使用高速化', maxLevel: 3, description: '加快磨刀速度' },
            { id: 'stun_resistance', name: '耐暈', maxLevel: 3, description: '減少暈眩時間' },
            { id: 'health_boost', name: '體力增強', maxLevel: 3, description: '提升最大體力' }
        ];

        const ARMOR_DATA = {
            head: [
                { id: 'rathalos_helm', name: '火龍頭盔', defense: 82, skills: { attack_boost: 2, weakness_exploit: 1 }, slots: [2, 1] },
                { id: 'doshaguma_helm', name: '土砂龍頭盔', defense: 76, skills: { constitution: 2, evade_extender: 1 }, slots: [1, 1] },
                { id: 'rey_dau_helm', name: '雷狼龍頭盔', defense: 84, skills: { critical_eye: 2, speed_eating: 1 }, slots: [2] },
                { id: 'chatacabra_helm', name: '恰恰布拉頭盔', defense: 72, skills: { divine_blessing: 2 }, slots: [1, 1, 1] },
                { id: 'balahara_helm', name: '巴拉哈拉頭盔', defense: 78, skills: { health_boost: 2, stun_resistance: 1 }, slots: [2, 1] }
            ],
            chest: [
                { id: 'rathalos_mail', name: '火龍鎧甲', defense: 82, skills: { attack_boost: 2, weakness_exploit: 1 }, slots: [2] },
                { id: 'doshaguma_mail', name: '土砂龍鎧甲', defense: 76, skills: { constitution: 2, agitator: 1 }, slots: [1, 1] },
                { id: 'rey_dau_mail', name: '雷狼龍鎧甲', defense: 84, skills: { critical_eye: 3 }, slots: [2, 1] },
                { id: 'chatacabra_mail', name: '恰恰布拉鎧甲', defense: 72, skills: { divine_blessing: 1, evade_window: 2 }, slots: [1] },
                { id: 'balahara_mail', name: '巴拉哈拉鎧甲', defense: 78, skills: { health_boost: 1, stun_resistance: 2 }, slots: [2] }
            ],
            arms: [
                { id: 'rathalos_braces', name: '火龍護腕', defense: 82, skills: { attack_boost: 2 }, slots: [2, 1, 1] },
                { id: 'doshaguma_braces', name: '土砂龍護腕', defense: 76, skills: { constitution: 1, speed_sharpening: 2 }, slots: [1] },
                { id: 'rey_dau_braces', name: '雷狼龍護腕', defense: 84, skills: { critical_eye: 2, agitator: 1 }, slots: [2] },
                { id: 'chatacabra_braces', name: '恰恰布拉護腕', defense: 72, skills: { divine_blessing: 2, speed_eating: 1 }, slots: [1, 1] },
                { id: 'balahara_braces', name: '巴拉哈拉護腕', defense: 78, skills: { health_boost: 2 }, slots: [2, 2] }
            ],
            waist: [
                { id: 'rathalos_coil', name: '火龍腰帶', defense: 82, skills: { weakness_exploit: 2, attack_boost: 1 }, slots: [1, 1] },
                { id: 'doshaguma_coil', name: '土砂龍腰帶', defense: 76, skills: { constitution: 1, evade_extender: 2 }, slots: [2] },
                { id: 'rey_dau_coil', name: '雷狼龍腰帶', defense: 84, skills: { critical_eye: 2 }, slots: [2, 2] },
                { id: 'chatacabra_coil', name: '恰恰布拉腰帶', defense: 72, skills: { divine_blessing: 1, evade_window: 1 }, slots: [1, 1, 1] },
                { id: 'balahara_coil', name: '巴拉哈拉腰帶', defense: 78, skills: { health_boost: 1, stun_resistance: 1 }, slots: [2, 1] }
            ],
            legs: [
                { id: 'rathalos_greaves', name: '火龍護腿', defense: 82, skills: { attack_boost: 2, weakness_exploit: 1 }, slots: [1] },
                { id: 'doshaguma_greaves', name: '土砂龍護腿', defense: 76, skills: { constitution: 2, speed_sharpening: 1 }, slots: [1, 1] },
                { id: 'rey_dau_greaves', name: '雷狼龍護腿', defense: 84, skills: { critical_eye: 2, agitator: 2 }, slots: [2] },
                { id: 'chatacabra_greaves', name: '恰恰布拉護腿', defense: 72, skills: { divine_blessing: 2, evade_window: 1 }, slots: [2, 1] },
                { id: 'balahara_greaves', name: '巴拉哈拉護腿', defense: 78, skills: { health_boost: 2, stun_resistance: 1 }, slots: [1, 1] }
            ]
        };

        // 狀態管理
        let selectedSkills = {};
        let searchTerm = '';

        // 初始化整個應用程式
        function initApp() {
            const appContainer = document.getElementById('app');
            appContainer.innerHTML = `
                <div class="max-w-7xl mx-auto">
                    <h1 class="text-3xl md:text-4xl font-bold mb-2 text-center bg-gradient-to-r from-orange-400 to-red-500 bg-clip-text text-transparent">
                        魔物獵人荒野配裝器
                    </h1>
                    <p class="text-center text-slate-400 mb-8">選擇想要的技能，系統會自動推薦最佳配裝組合</p>

                    <div class="grid lg:grid-cols-2 gap-6">
                        <!-- 左側：技能選擇 -->
                        <div class="bg-slate-800/50 backdrop-blur rounded-xl p-6 border border-slate-700">
                            <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
                                <span class="text-orange-400">①</span> 選擇技能
                            </h2>
                            
                            <input
                                type="text"
                                id="searchInput"
                                placeholder="搜尋技能..."
                                class="w-full px-4 py-2 mb-4 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-orange-400 text-white"
                            />

                            <!-- 已選技能 -->
                            <div id="selectedSkills" class="mb-4 hidden p-4 bg-slate-900/50 rounded-lg border border-orange-500/30">
                                <div class="text-sm text-slate-400 mb-2">已選技能：</div>
                                <div id="selectedSkillsList" class="flex flex-wrap gap-2"></div>
                            </div>

                            <!-- 技能列表 -->
                            <div id="skillsList" class="space-y-2 max-h-96 overflow-y-auto"></div>
                        </div>

                        <!-- 右側：配裝結果 -->
                        <div class="bg-slate-800/50 backdrop-blur rounded-xl p-6 border border-slate-700">
                            <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
                                <span class="text-orange-400">②</span> 推薦配裝
                            </h2>
                            <div id="resultsArea"></div>
                        </div>
                    </div>

                    <div class="mt-6 text-center text-sm text-slate-500">
                        <p>示範版本 - 使用部分資料 | 實際遊戲請參考官方資料</p>
                    </div>
                </div>
            `;

            // 綁定事件
            document.getElementById('searchInput').addEventListener('input', (e) => {
                searchTerm = e.target.value.toLowerCase();
                renderSkills();
            });

            // 初始渲染
            renderSkills();
            showInitialMessage();
        }

        // 渲染技能列表
        function renderSkills() {
            const filteredSkills = SKILLS.filter(skill =>
                skill.name.toLowerCase().includes(searchTerm) ||
                skill.description.toLowerCase().includes(searchTerm)
            );

            const skillsList = document.getElementById('skillsList');
            skillsList.innerHTML = filteredSkills.map(skill => `
                <div class="skill-card bg-slate-900/30 p-4 rounded-lg border border-slate-700 hover:border-slate-600">
                    <div class="font-semibold mb-1">${skill.name}</div>
                    <div class="text-sm text-slate-400 mb-3">${skill.description}</div>
                    <div class="flex gap-2 flex-wrap">
                        ${Array.from({length: skill.maxLevel}, (_, i) => {
                            const level = i + 1;
                            const isSelected = selectedSkills[skill.id] === level;
                            return `
                                <button
                                    onclick="toggleSkill('${skill.id}', ${level})"
                                    class="px-3 py-1 rounded transition ${
                                        isSelected
                                            ? 'bg-orange-500 text-white font-bold'
                                            : 'bg-slate-700 hover:bg-slate-600 text-slate-200'
                                    }"
                                >
                                    Lv${level}
                                </button>
                            `;
                        }).join('')}
                    </div>
                </div>
            `).join('');

            renderSelectedSkills();
        }

        // 渲染已選技能
        function renderSelectedSkills() {
            const container = document.getElementById('selectedSkills');
            const list = document.getElementById('selectedSkillsList');
            
            if (Object.keys(selectedSkills).length === 0) {
                container.classList.add('hidden');
                return;
            }

            container.classList.remove('hidden');
            list.innerHTML = Object.entries(selectedSkills).map(([skillId, level]) => {
                const skill = SKILLS.find(s => s.id === skillId);
                return `
                    <div class="flex items-center gap-2 bg-orange-500/20 px-3 py-1 rounded-full text-orange-200">
                        <span class="text-sm font-medium">${skill.name} Lv${level}</span>
                        <button onclick="removeSkill('${skillId}')" class="hover:text-red-400 text-lg leading-none font-bold">×</button>
                    </div>
                `;
            }).join('');
        }

        // 切換技能
        function toggleSkill(skillId, level) {
            if (selectedSkills[skillId] === level) {
                delete selectedSkills[skillId];
            } else {
                selectedSkills[skillId] = level;
            }
            renderSkills();
            if (Object.keys(selectedSkills).length > 0) {
                showCalculateButton();
            } else {
                showInitialMessage();
            }
        }

        // 移除技能
        function removeSkill(skillId) {
            delete selectedSkills[skillId];
            renderSkills();
            if (Object.keys(selectedSkills).length === 0) {
                showInitialMessage();
            } else {
                showCalculateButton();
            }
        }

        // 顯示初始訊息
        function showInitialMessage() {
            document.getElementById('resultsArea').innerHTML = `
                <div class="text-center py-20 text-slate-400">
                    <p class="text-lg">請先選擇想要的技能</p>
                    <p class="text-sm mt-2">系統會自動計算最佳配裝組合</p>
                </div>
            `;
        }

        // 顯示計算按鈕
        function showCalculateButton() {
            document.getElementById('resultsArea').innerHTML = `
                <div class="text-center py-20">
                    <button
                        onclick="calculateBuilds()"
                        class="px-8 py-3 bg-gradient-to-r from-orange-500 to-red-500 rounded-lg font-bold hover:from-orange-600 hover:to-red-600 transition shadow-lg transform hover:scale-105"
                    >
                        開始計算配裝
                    </button>
                    <p class="text-sm text-slate-400 mt-4">已選擇 ${Object.keys(selectedSkills).length} 個技能</p>
                </div>
            `;
        }

        // 計算配裝
        function calculateBuilds() {
            const results = document.getElementById('resultsArea');
            results.innerHTML = '<div class="text-center py-20 text-slate-400 animate-pulse">計算中...</div>';

            setTimeout(() => {
                const builds = generateBuilds();
                renderBuilds(builds);
            }, 300);
        }

        // 生成配裝
        function generateBuilds() {
            const allBuilds = [];

            ARMOR_DATA.head.forEach(head => {
                ARMOR_DATA.chest.forEach(chest => {
                    ARMOR_DATA.arms.forEach(arms => {
                        ARMOR_DATA.waist.forEach(waist => {
                            ARMOR_DATA.legs.forEach(legs => {
                                const build = { head, chest, arms, waist, legs };
                                const skills = calculateBuildSkills(build);
                                const score = scoreBuild(skills);
                                const defense = head.defense + chest.defense + arms.defense + waist.defense + legs.defense;
                                allBuilds.push({ ...build, skills, score, defense });
                            });
                        });
                    });
                });
            });

            return allBuilds.sort((a, b) => b.score - a.score).slice(0, 10);
        }

        // 計算技能
        function calculateBuildSkills(build) {
            const totalSkills = {};
            ['head', 'chest', 'arms', 'waist', 'legs'].forEach(part => {
                const armor = build[part];
                Object.entries(armor.skills).forEach(([skill, level]) => {
                    totalSkills[skill] = (totalSkills[skill] || 0) + level;
                });
            });
            return totalSkills;
        }

        // 評分
        function scoreBuild(buildSkills) {
            let score = 0;
            Object.entries(selectedSkills).forEach(([skillId, desiredLevel]) => {
                const actualLevel = buildSkills[skillId] || 0;
                if (actualLevel >= desiredLevel) {
                    score += desiredLevel * 10;
                } else {
                    score += actualLevel * 5;
                }
            });
            return score;
        }

        // 渲染配裝結果
        function renderBuilds(builds) {
            const results = document.getElementById('resultsArea');
            
            if (builds.length === 0) {
                results.innerHTML = `
                    <div class="text-center py-20 text-slate-400">
                        <p class="text-lg">找不到符合的配裝</p>
                        <p class="text-sm mt-2">請嘗試降低技能等級或選擇較少技能</p>
                    </div>
                `;
                return;
            }

            results.innerHTML = `
                <div class="space-y-4 max-h-[600px] overflow-y-auto pr-2">
                    ${builds.map((build, idx) => `
                        <div class="bg-slate-900/50 p-4 rounded-lg border border-slate-600 hover:border-slate-500 transition">
                            <div class="flex items-center justify-between mb-3">
                                <span class="font-bold text-lg">配裝方案 #${idx + 1}</span>
                                <div class="flex gap-2">
                                    <span class="text-xs bg-blue-500/20 text-blue-300 px-2 py-1 rounded">
                                        防禦: ${build.defense}
                                    </span>
                                    <span class="text-xs bg-orange-500/20 text-orange-300 px-2 py-1 rounded">
                                        評分: ${build.score}
                                    </span>
                                </div>
                            </div>
                            
                            <div class="space-y-1.5 mb-3 text-sm">
                                ${['head', 'chest', 'arms', 'waist', 'legs'].map(part => {
                                    const partNames = {
                                        head: '頭部',
                                        chest: '胸部',
                                        arms: '手部',
                                        waist: '腰部',
                                        legs: '腳部'
                                    };
                                    return `
                                        <div class="flex items-center gap-2">
                                            <span class="text-slate-400 w-12">${partNames[part]}:</span>
                                            <span class="font-medium text-slate-200">${build[part].name}</span>
                                            <span class="text-xs text-slate-500">(防${build[part].defense})</span>
                                        </div>
                                    `;
                                }).join('')}
                            </div>

                            <div class="border-t border-slate-700 pt-3">
                                <div class="text-xs text-slate-400 mb-2">總技能:</div>
                                <div class="flex flex-wrap gap-1.5">
                                    ${Object.entries(build.skills)
                                        .sort((a, b) => {
                                            const aRequired = selectedSkills[a[0]];
                                            const bRequired = selectedSkills[b[0]];
                                            if (aRequired && !bRequired) return -1;
                                            if (!aRequired && bRequired) return 1;
                                            return 0;
                                        })
                                        .map(([skillId, level]) => {
                                            const skill = SKILLS.find(s => s.id === skillId);
                                            const isRequired = selectedSkills[skillId];
                                            const isFulfilled = isRequired && level >= selectedSkills[skillId];
                                            return `
                                                <div class="text-xs px-2 py-1 rounded ${
                                                    isFulfilled
                                                        ? 'bg-green-500/20 text-green-300 font-medium'
                                                        : isRequired
                                                        ? 'bg-yellow-500/20 text-yellow-300'
                                                        : 'bg-slate-700 text-slate-300'
                                                }">
                                                    ${skill?.name || skillId} Lv${level}
                                                    ${isFulfilled ? ' ✓' : ''}
                                                </div>
                                            `;
                                        }).join('')}
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // 當頁面載入完成後啟動應用程式
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initApp);
        } else {
            initApp();
        }
    </script>
</body>
</html>
